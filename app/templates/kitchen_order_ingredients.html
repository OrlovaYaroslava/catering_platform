{% extends "base.html" %}

{% block title %}–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∑–∞–∫–∞–∑–∞ ‚Ññ{{ order.id }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üìã –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∑–∞–∫–∞–∑–∞ ‚Ññ{{ order.id }}</h2>
        <a href="{{ url_for('main.kitchen_order_detail', order_id=order.id) }}" 
           class="btn btn-outline-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑—É
        </a>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ -->
    <div class="alert alert-info">
        <strong>–°—Ç–∞—Ç—É—Å:</strong> {{ order.status }} | 
        <strong>–î–∞—Ç–∞:</strong> {{ order.event_date }} | 
        <strong>–ì–æ—Å—Ç–∏:</strong> {{ order.guests_count }}
    </div>

    {% if ingredients %}
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</th>
                            <th class="text-end">–¢—Ä–µ–±—É–µ—Ç—Å—è</th>
                            <th class="text-end">–í –Ω–∞–ª–∏—á–∏–∏</th>
                            <th class="text-end">–î–µ—Ñ–∏—Ü–∏—Ç</th>
                            <th class="text-center">–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for data in ingredients %}
                        <tr class="{% if data.deficit > 0 %}table-danger{% endif %}">
                            <td>
                                {% if data.deficit > 0 %}üî¥{% else %}üü¢{% endif %}
                                <strong>{{ data.ingredient.name }}</strong>
                            </td>
                            <td class="text-end">{{ data.required }} {{ data.ingredient.unit }}</td>
                            <td class="text-end">{{ data.in_stock }} {{ data.ingredient.unit }}</td>
                            <td class="text-end">
                                {% if data.deficit > 0 %}
                                    <span class="badge bg-danger">‚àí{{ data.deficit }} {{ data.ingredient.unit }}</span>
                                {% else %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if data.deficit > 0 %}
                                    <span class="badge bg-danger">‚ùå –î–µ—Ñ–∏—Ü–∏—Ç</span>
                                {% else %}
                                    <span class="badge bg-success">‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ -->
    {% set total_deficit = ingredients|selectattr('deficit', '>', 0)|list %}
    {% if total_deficit %}
    <div class="alert alert-danger mt-3">
        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç {{ total_deficit|length }} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞(–æ–≤) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.
        <br>
        <small>–ü–æ–ø–æ–ª–Ω–∏—Ç–µ —Å–∫–ª–∞–¥ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è.</small>
    </div>
    {% else %}
    <div class="alert alert-success mt-3">
        <strong>‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!</strong> –í—Å–µ—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.
    </div>
    {% endif %}

    {% else %}
    <div class="alert alert-warning">
        <p class="mb-0">üì≠ –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤.</p>
        <p class="mb-0 mt-2"><small>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</small></p>
        <ul class="mb-0">
            <li>–£ –±–ª—é–¥ –Ω–µ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç (DishIngredient)</li>
            <li>–ó–∞–∫–∞–∑ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏–π</li>
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}
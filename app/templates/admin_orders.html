{% extends "base.html" %}

{% block title %}–í—Å–µ –∑–∞–∫–∞–∑—ã{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üìã –í—Å–µ –∑–∞–∫–∞–∑—ã</h1>
        <a href="{{ url_for('main.admin_dashboard') }}" class="btn btn-outline-secondary">
            ‚Üê –ù–∞ –¥–∞—à–±–æ—Ä–¥
        </a>
    </div>

    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –°–¢–ê–¢–£–°–ê–ú -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body py-2">
                    <div class="nav nav-pills" role="tablist">
                        <a class="nav-link {% if current_status == 'all' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='all', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –í—Å–µ <span class="badge bg-secondary">{{ status_counts.all }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'new' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='new', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –ù–æ–≤—ã–µ <span class="badge bg-primary">{{ status_counts.new }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'awaiting_payment' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='awaiting_payment', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã <span class="badge bg-warning text-dark">{{ status_counts.awaiting_payment }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'paid' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='paid', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –û–ø–ª–∞—á–µ–Ω—ã <span class="badge bg-success">{{ status_counts.paid }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'cooking' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='cooking', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –í —Ä–∞–±–æ—Ç–µ <span class="badge bg-info">{{ status_counts.cooking }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'ready' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='ready', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –ì–æ—Ç–æ–≤—ã <span class="badge bg-purple" style="background-color: #6f42c1;">{{ status_counts.ready }}</span>
                        </a>
                        <a class="nav-link {% if current_status == 'completed' %}active{% endif %}" 
                           href="{{ url_for('main.admin_orders', status='completed', search=search_query, date_from=date_from, date_to=date_to, sort=sort_by) }}">
                            –í—ã–ø–æ–ª–Ω–µ–Ω—ã <span class="badge bg-secondary">{{ status_counts.completed }}</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–ò–õ–¨–¢–†–´ –ò –ü–û–ò–°–ö -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" class="row g-3">
                <input type="hidden" name="status" value="{{ current_status }}">
                
                <div class="col-md-3">
                    <label class="form-label">üîç –ü–æ–∏—Å–∫</label>
                    <input type="text" name="search" class="form-control" 
                           placeholder="‚Ññ –∑–∞–∫–∞–∑–∞ –∏–ª–∏ email" 
                           value="{{ search_query }}">
                </div>
                
                <div class="col-md-2">
                    <label class="form-label">üìÖ –° –¥–∞—Ç—ã</label>
                    <input type="date" name="date_from" class="form-control" value="{{ date_from }}">
                </div>
                
                <div class="col-md-2">
                    <label class="form-label">üìÖ –ü–æ –¥–∞—Ç—É</label>
                    <input type="date" name="date_to" class="form-control" value="{{ date_to }}">
                </div>
                
                <div class="col-md-3">
                    <label class="form-label">üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                    <select name="sort" class="form-select">
                        <option value="created_at_desc" {% if sort_by == 'created_at_desc' %}selected{% endif %}>
                            ‚¨á –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                        </option>
                        <option value="created_at_asc" {% if sort_by == 'created_at_asc' %}selected{% endif %}>
                            ‚¨Ü –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ —Å–≤–µ—Ä—Ö—É)
                        </option>
                        <option value="amount_desc" {% if sort_by == 'amount_desc' %}selected{% endif %}>
                            üí∞ –ü–æ —Å—É–º–º–µ (–¥–æ—Ä–æ–≥–∏–µ —Å–≤–µ—Ä—Ö—É)
                        </option>
                        <option value="amount_asc" {% if sort_by == 'amount_asc' %}selected{% endif %}>
                            üí∞ –ü–æ —Å—É–º–º–µ (–¥–µ—à—ë–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                        </option>
                    </select>
                </div>
                
                <div class="col-md-2 d-flex align-items-end gap-2">
                    <button type="submit" class="btn btn-primary flex-fill">
                        üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                    <a href="{{ url_for('main.admin_orders') }}" class="btn btn-outline-secondary">
                        ‚úñ
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ü–ò–°–û–ö –ó–ê–ö–ê–ó–û–í -->
    {% if orders %}
    <div class="alert alert-info">
        üìä –ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: <strong>{{ orders|length }}</strong>
        {% if current_status != 'all' %}
            (—Å—Ç–∞—Ç—É—Å: <strong>{{ current_status }}</strong>)
        {% endif %}
    </div>

    <div class="row">
        {% for order in orders %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 {% if order.status == 'new' %}border-primary{% elif order.status == 'paid' %}border-success{% elif order.status == 'cooking' %}border-info{% elif order.status == 'ready' %}border-purple{% elif order.status == 'completed' %}border-secondary{% endif %}" 
                 style="border-width: 3px;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üì¶ –ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h5>
                    <span class="badge 
                        {% if order.status == 'new' %}bg-primary
                        {% elif order.status == 'awaiting_payment' %}bg-warning text-dark
                        {% elif order.status == 'paid' %}bg-success
                        {% elif order.status == 'cooking' %}bg-info
                        {% elif order.status == 'ready' %}bg-purple
                        {% elif order.status == 'completed' %}bg-secondary
                        {% else %}bg-light text-dark{% endif %}">
                        {{ order.status }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <small class="text-muted">üë§ –ö–ª–∏–µ–Ω—Ç:</small><br>
                        <strong>{{ order.user.email if order.user else '–ê–Ω–æ–Ω–∏–º' }}</strong>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">üìÖ –î–∞—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</small><br>
                        <strong>{{ order.event_date }}</strong>
                        {% if order.event_time %} {{ order.event_time }}{% endif %}
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">üë• –ì–æ—Å—Ç–∏:</small>
                        <strong>{{ order.guests_count or '‚Äî' }}</strong>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">üí∞ –°—É–º–º–∞:</small><br>
                        <h4 class="text-primary mb-0">{{ order.total_price }} ‚ÇΩ</h4>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">üïê –°–æ–∑–¥–∞–Ω:</small><br>
                        {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    {% if order.address %}
                    <div class="mb-2">
                        <small class="text-muted">üìç –ê–¥—Ä–µ—Å:</small><br>
                        {{ order.address[:50] }}{% if order.address|length > 50 %}...{% endif %}
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <a href="{{ url_for('main.admin_order_detail', order_id=order.id) }}" 
                       class="btn btn-primary w-100">
                        üîç –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="alert alert-warning">
        üì≠ –ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.
    </div>
    {% endif %}
</div>

<style>
.border-purple { border-color: #6f42c1 !important; }
.bg-purple { background-color: #6f42c1 !important; }
.nav-pills .nav-link { margin-right: 5px; margin-bottom: 5px; }
</style>
{% endblock %}